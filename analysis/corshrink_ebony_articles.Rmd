---
title: 'CorShrink on Ebony articles : 1968'
author: "Kushal K Dey"
date: "5/30/2018"
output: html_document
---


We look at CorShrink similarity measures and corresponding rankings of words and compare
them with the empirical similarity and rankings without the **CorShrink** model. We pick two topic words to focus on - *martin luther king*, *civil rights*
and then perform bagging on all the different articles.

## Martin Luther King 

```{r}
mat <- get(load("../output/word2vec_Ebony_articles/martin_luther_king_corshrink_articles.rda"))
cor_original <- mat$original
corshrink_mat <- mat$corshrink
```


```{r}
word_frequencies_mat <- get(load("../output/word2vec_Ebony/word_frequencies.rda"))
word_presence_absence <- word_frequencies_mat
word_presence_absence[word_presence_absence > 0] = 1
```

```{r}
matched_word_frequencies <- word_presence_absence[, match(rownames(corshrink_mat), colnames(word_presence_absence))]
```

```{r}
num_occurrences_words <- colSums(matched_word_frequencies)
```

```{r}
num_occurrence_matrix <- sapply(num_occurrences_words, function(l) pmin(l, num_occurrences_words))
```

```{r}
word_pairs <- combn(colnames(cor_original),2)
```

```{r fig.height = 5, fig.width = 5}
df1 <- data.frame("original" = cor_original[lower.tri(cor_original)],
                 "corshrink" = corshrink_mat[lower.tri(corshrink_mat)],
                 "nsamp" = num_occurrence_matrix[lower.tri(num_occurrence_matrix)])
df1$nsamp[which(is.na(df1$nsamp))] = max(df1$nsamp, na.rm = TRUE)

colfunc <- colorRampPalette(c("lightcyan", "darkcyan"))
plot(df1$original, df1$corshrink, bg = 2, col = colfunc(12)[df1$nsamp], pch = 19, cex = 1, xlab = "cosine similarity", ylab = "corshrink similarity", ylim = c(-0.5,1))
abline(0,1)

ids <- which(df1$original > 0.6)
ids2 <- order(df1$original - df1$corshrink, decreasing = TRUE)[1:20]
terms <- paste0(word_pairs[1,ids], ":", word_pairs[2,ids])
terms2 <- paste0(word_pairs[1,ids2], ":", word_pairs[2,ids2])
text(df1$original[ids], df1$corshrink[ids], terms,cex = 0.5)
```

```{r}
# sort(apply(corshrink_mat[c("dr_king", "dr_kings", "martin_luther_king"),], 2, mean), decreasing = TRUE)[1:30]
tmp <- sort(apply(corshrink_mat[c("martin_luther_king", "dr_kings", "dr_king"),], 2, mean), decreasing = TRUE)[1:30]
names2 <- setdiff(names(tmp), c("kings", "this", "was", "dr_kings"))
aa <- tmp[match(names2, names(tmp))]
aa["martin_luther_king"] <- 1.0000000
aa["dr_king"] <- 1.0000000
aa[1:20]
```

```{r}
# sort(apply(cor_original[c("dr_king", "dr_kings", "martin_luther_king"),], 2, mean), decreasing = TRUE)[1:30]
#sort(cor_original[c("martin_luther_king"),], decreasing = TRUE)[1:30]
tmp <- sort(apply(cor_original[c("martin_luther_king", "dr_kings", "dr_king"),], 2, mean), decreasing = TRUE)[1:30]
names2 <- setdiff(names(tmp), c("kings", "this", "was", "dr_kings"))
aa <- tmp[match(names2, names(tmp))]
aa["martin_luther_king"] <- 1.0000000
aa["dr_king"] <- 1.0000000
aa[1:20]
```


## Civil rights

```{r}
mat <- get(load("../output/word2vec_Ebony_articles/civil_rights_corshrink_articles.rda"))
cor_original <- mat$original
corshrink_mat <- mat$corshrink
```


```{r}
word_frequencies_mat <- get(load("../output/word2vec_Ebony/word_frequencies.rda"))
word_presence_absence <- word_frequencies_mat
word_presence_absence[word_presence_absence > 0] = 1
```

```{r}
matched_word_frequencies <- word_presence_absence[, match(rownames(corshrink_mat), colnames(word_presence_absence))]
```

```{r}
num_occurrences_words <- colSums(matched_word_frequencies)
```

```{r}
num_occurrence_matrix <- sapply(num_occurrences_words, function(l) pmin(l, num_occurrences_words))
```

```{r}
word_pairs <- combn(colnames(cor_original),2)
```

```{r fig.height = 5, fig.width = 5}
df1 <- data.frame("original" = cor_original[lower.tri(cor_original)],
                 "corshrink" = corshrink_mat[lower.tri(corshrink_mat)],
                 "nsamp" = num_occurrence_matrix[lower.tri(num_occurrence_matrix)])
df1$nsamp[which(is.na(df1$nsamp))] = max(df1$nsamp, na.rm = TRUE)

colfunc <- colorRampPalette(c("lightcyan", "darkcyan"))
plot(df1$original, df1$corshrink, bg = 2, col = colfunc(12)[df1$nsamp], pch = 19, cex = 1, xlab = "cosine similarity", ylab = "corshrink similarity", ylim = c(-0.5,1))
abline(0,1)

ids <- which(df1$original > 0.6)
ids2 <- order(df1$original - df1$corshrink, decreasing = TRUE)[1:20]
terms <- paste0(word_pairs[1,ids], ":", word_pairs[2,ids])
terms2 <- paste0(word_pairs[1,ids2], ":", word_pairs[2,ids2])
text(df1$original[ids], df1$corshrink[ids], terms,cex = 0.5)
```

```{r}
# sort(apply(corshrink_mat[c("civil_rights", "civil", "rights"),], 2, mean), decreasing = TRUE)[1:30]
tmp <- sort(corshrink_mat[c("civil_rights"),], decreasing = TRUE)[1:20]
tmp
```

```{r}
sort(cor_original[c("civil_rights"),], decreasing = TRUE)[1:20]
```

## SessionInfo

```{r}
sessionInfo()
```

